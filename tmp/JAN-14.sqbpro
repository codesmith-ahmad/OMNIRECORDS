<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="C:/OMNIRECORDS/OmniRecords-Database/omnirecords.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure pragmas query browser" current="2"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="125"/><column_width id="3" width="7999"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><current_table name="4,12:mainExpensesView"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="Archives" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="160"/><column index="2" value="300"/><column index="3" value="91"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="CLONE_expenses" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="1" mode="0"/></sort><column_widths><column index="1" value="52"/><column index="2" value="262"/><column index="3" value="66"/><column index="4" value="76"/><column index="5" value="96"/><column index="6" value="167"/><column index="7" value="135"/><column index="8" value="83"/><column index="9" value="67"/><column index="10" value="52"/><column index="11" value="61"/><column index="12" value="52"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats><column index="2" value=""/></display_formats><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Expenses" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="52"/><column index="2" value="124"/><column index="3" value="66"/><column index="4" value="78"/><column index="5" value="167"/><column index="6" value="135"/><column index="7" value="91"/><column index="8" value="69"/><column index="9" value="300"/><column index="10" value="61"/><column index="11" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="ExpensesView" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="52"/><column index="2" value="124"/><column index="3" value="147"/><column index="4" value="156"/><column index="5" value="165"/><column index="6" value="91"/><column index="7" value="153"/><column index="8" value="69"/><column index="9" value="61"/><column index="10" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="TODO" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="52"/><column index="2" value="437"/><column index="3" value="348"/></column_widths><filter_values/><conditional_formats><column index="3"><format condition="status = 'DONE'" background="#00ff00" foreground="#000000" font="MS Shell Dlg 2,10,-1,5,50,0,0,0,0,0" align="0"/></column></conditional_formats><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="archives" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="229"/><column index="2" value="1045"/><column index="3" value="91"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="assignments" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="52"/><column index="2" value="67"/><column index="3" value="208"/><column index="4" value="83"/><column index="5" value="108"/><column index="6" value="149"/><column index="7" value="77"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="courses_info" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="115"/><column index="2" value="52"/><column index="3" value="52"/><column index="4" value="52"/><column index="5" value="79"/><column index="6" value="67"/><column index="7" value="61"/><column index="8" value="92"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="documents" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="52"/><column index="2" value="238"/><column index="3" value="101"/><column index="4" value="1098"/><column index="5" value="97"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="events" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="52"/><column index="2" value="103"/><column index="3" value="106"/><column index="4" value="142"/><column index="5" value="99"/><column index="6" value="91"/><column index="7" value="79"/><column index="8" value="145"/><column index="9" value="172"/><column index="10" value="99"/><column index="11" value="91"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="expenses" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="12" mode="0"/></sort><column_widths><column index="1" value="52"/><column index="2" value="124"/><column index="3" value="66"/><column index="4" value="78"/><column index="5" value="167"/><column index="6" value="135"/><column index="7" value="91"/><column index="8" value="69"/><column index="9" value="300"/><column index="10" value="52"/><column index="11" value="580"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="expenses_changelog" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="91"/><column index="2" value="52"/><column index="3" value="116"/><column index="4" value="66"/><column index="5" value="78"/><column index="6" value="167"/><column index="7" value="135"/><column index="8" value="91"/><column index="9" value="69"/><column index="10" value="300"/><column index="11" value="61"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="metadata" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="285"/><column index="2" value="764"/><column index="3" value="192"/><column index="4" value="270"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="months" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="66"/><column index="2" value="124"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="special_events" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="1" mode="0"/></sort><column_widths><column index="1" value="52"/><column index="2" value="188"/><column index="3" value="183"/><column index="4" value="96"/><column index="5" value="101"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="sqlite_sequence" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="100"/><column index="2" value="52"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="timeslots" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="107"/><column index="2" value="86"/><column index="3" value="99"/><column index="4" value="91"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 9">with 
	cte as (
		select 
			123289 as frequency,
			date(CURRENT_TIMESTAMP) as d0,
			date(&quot;2024-05-01&quot;) as d1
	),
	
	frequencies as (
		select
			cast(frequency / 10000 as text) || &quot; years&quot; as yearly,
			cast(frequency % 10000 / 100 as text)    || &quot; months&quot; as monthly,
			cast(frequency % 100 as text)    || &quot; days&quot; as daily
		from cte
	)

select 
	frequency,
	yearly,
	monthly,
	daily,
	d0,
	date(d0, monthly, daily)
from cte, frequencies</sql><sql name="SQL 10">
drop trigger archives_directory;

CREATE TRIGGER archives_folderpath_insert
AFTER INSERT ON &quot;archives&quot;
BEGIN
	UPDATE &quot;archives&quot;
	SET doc_path = path_of_library || &quot;\archives\&quot; || replace(lower(trim(doc_name)),&quot; &quot;,&quot;-&quot;) || &quot;.&quot; || type
	from (select value as path_of_library from metadata where key = &quot;library_location&quot;);
END;

CREATE TRIGGER archives_folderpath_update
AFTER UPDATE ON &quot;archives&quot;
BEGIN
	UPDATE &quot;archives&quot;
	SET doc_path = path_of_library || &quot;\archives\&quot; || replace(lower(trim(doc_name)),&quot; &quot;,&quot;-&quot;) || &quot;.&quot; || type
	from (select value as path_of_library from metadata where key = &quot;library_location&quot;);
END;</sql><sql name="SQL 11">
insert into CLONE_expenses (id,bill,isLoan,amount,FrequencyNumber,FrequencyUnit,deadline,source,note,isPaid,files)
select id,bill,isLoan,amount,FrequencyNumber,FrequencyUnit,deadline,source,note,isPaid,file  from expenses;

SELECT * from CLONE_expenses;</sql><sql name="SQL 13">CREATE VIEW CloneExpensesView AS

	WITH

	constants AS (
		SELECT 
			30.437 AS averageDaysInMonth
	),
	
	frequencies as (
		select
			frequency / 100000 		  as f_years,
			frequency % 100000 / 1000 as f_months,
			frequency % 1000 	  	  as f_days
		from CLONE_expenses;
	),
	
	dailyRate AS (
		CASE
			  WHEN f_years  &gt; 0 THEN amount / (f_years  * 365)
			  WHEN f_months &gt; 0 THEN amount / (f_months * 30.437)
			  WHEN f_days   &gt; 0 THEN amount / (f_days)
			  ELSE NULL -- Handle other cases if needed
		END AS dailyRate
		FROM frequencies, expenses;
	)

	SELECT
		-- X to indicate expenses, for frontend purpose
		'X-' || e.id AS id,
		-- Bill as is
		Bill,
		-- Calculate rates according to amount and frequency
		(averageDaysInMonth * d.rate) AS Monthly,
		(7 * d.rate) AS Weekly,
		d.rate AS Daily,
		-- Requires external formatting: foreach ($row in $x) {$row.Deadline = (date $row.Deadline -format &quot;MMM d&quot;).toUpper()}
		Deadline,
		-- Calculate time left
		julianday(Deadline) - julianday('now') as Remains,
		-- Source as is
		Source,
		-- isPaid: Change 0/1 to False/True
		CASE
			WHEN isPaid = 0 THEN 'False'
			WHEN isPaid = 1 THEN 'True'
		END AS isPaid,
		-- Note as is
		Note
		
	FROM &quot;expenses&quot;  		   AS e
	JOIN constants 		   AS c ON true
	JOIN dailyRate 		   AS d ON d.id = e.id
	
	ORDER BY Deadline</sql><current_tab id="3"/></tab_sql></sqlb_project>
